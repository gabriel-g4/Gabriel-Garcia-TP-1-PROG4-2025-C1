import { CommonModule } from '@angular/common';
import { HostListener, Component, OnDestroy } from '@angular/core';
import { SupabaseService } from '../../../services/supabase.service';
import { AuthService } from '../../../services/auth.service';
import { RouterLink, RouterLinkActive } from '@angular/router';
import { DatosNivel, Mapa, Posicion } from '../../../models';


@Component({
  selector: 'app-juego-propio',
  imports: [CommonModule, RouterLink, RouterLinkActive],
  templateUrl: './juego-propio.component.html',
  styleUrl: './juego-propio.component.css'
})


export class JuegoPropioComponent implements OnDestroy{

    dataMapas: Mapa[] = [
    {
      texto:
        '----#####\n----#---#\n----#$--#\n--###--$##\n--#--$-$-#\n###-#-##-#---######\n#---#-##-#####--..#\n#-$--$----------..#\n#####-###-#@##--..#\n----#-----#########\n----#######',
      titulo: '1',
      comentarios: 'Sokoban #1. Arranged.',
    },
    {
      texto:
        '############\n#..--#-----###\n#..--#-$--$--#\n#..--#$####--#\n#..----@-##--#\n#..--#-#--$-##\n######-##$-$-#\n--#-$--$-$-$-#\n--#----#-----#\n--############',
      titulo: '2',
      comentarios: 'Sokoban #2',
    },

    {
      texto:
        '--------########\n--------#-----@#\n--------#-$#$-##\n--------#-$--$#\n--------##$-$-#\n#########-$-#-###\n#....--##-$--$--#\n##...----$--$---#\n#....--##########\n########',
      titulo: '3',
      comentarios: 'Sokoban #3',
    },
    {
      texto:
        '-----------########\n-----------#--....#\n############--....#\n#----#--$-$---....#\n#-$$$#$--$-#--....#\n#--$-----$-#--....#\n#-$$-#$-$-$########\n#--$-#-----#\n##-#########\n#----#----##\n#-----$---##\n#--$$#$$--@#\n#----#----##\n###########',
      titulo: '4',
      comentarios: 'Sokoban #4. Arranged.',
    },
    {
      texto:
        '--------#####\n--------#---#####\n--------#-#$##--#\n--------#-----$-#\n#########-###---#\n#....--##-$--$###\n#....----$-$$-##\n#....--##$--$-@#\n#########--$--##\n--------#-$-$--#\n--------###-##-#\n----------#----#\n----------######',
      titulo: '5',
      comentarios: 'Sokoban #5.',
    },
    {
      texto:
        '######--###\n#..--#-##@##\n#..--###---#\n#..-----$$-#\n#..--#-#-$-#\n#..###-#-$-#\n####-$-#$--#\n---#--$#-$-#\n---#-$--$--#\n---#--##---#\n---#########',
      titulo: '6',
      comentarios: 'Sokoban #6',
    },
    {
      texto:
        '-------#####\n-#######---##\n##-#-@##-$$-#\n#----$------#\n#--$--###---#\n###-#####$###\n#-$--###-..#\n#-$-$-$-...#\n#----###...#\n#-$$-#-#...#\n#--###-#####\n####',
      titulo: '7',
      comentarios: 'Sokoban #7. Arranged.',
    },
    {
      texto:
        '--####\n--#--###########\n--#----$---$-$-#\n--#-$#-$-#--$--#\n--#--$-$--#----#\n###-$#-#--####-#\n#@#$-$-$--##---#\n#----$-#$#---#-#\n#---$----$-$-$-#\n#####--#########\n--#------#\n--#------#\n--#......#\n--#......#\n--#......#\n--########',
      titulo: '8',
      comentarios: 'Sokoban #8. Arranged. Error? Easier solution.',
    },
    {
      texto:
        '----------#######\n----------#--...#\n------#####--...#\n------#------.-.#\n------#--##--...#\n------##-##--...#\n-----###-########\n-----#-$$$-##\n-#####--$-$-#####\n##---#$-$---#---#\n#@-$--$----$--$-#\n######-$$-$-#####\n-----#------#\n-----########',
      titulo: '9',
      comentarios: 'Sokoban #9. Arranged. Minus one box.',
    },
    {
      texto:
        '-###--#############\n##@####-------#---#\n#-$$---$$--$-$-...#\n#--$$$#----$--#...#\n#-$---#-$$-$$-#...#\n###---#--$----#...#\n#-----#-$-$-$-#...#\n#----######-###...#\n##-#--#--$-$--#...#\n#--##-#-$$-$-$##..#\n#-..#-#--$------#.#\n#-..#-#-$$$-$$$-#.#\n#####-#-------#-#.#\n----#-#########-#.#\n----#-----------#.#\n----###############',
      titulo: '10',
      comentarios: 'Sokoban #10. Arranged. Minus two boxes.',
    },
    {
      texto:
        '----------####\n-----####-#--#\n---###-@###$-#\n--##------$--#\n-##--$-$$##-##\n-#--#$##-----#\n-#-#-$-$$-#-###\n-#---$-#--#-$-#####\n####----#--$$-#---#\n####-##-$---------#\n#.----###--########\n#..-..#-####\n#...#.#\n#.....#\n#######',
      titulo: '11',
      comentarios: 'Sokoban2 #1',
    },
    {
      texto:
        '################\n#--------------#\n#-#-######-----#\n#-#--$-$-$-$#--#\n#-#---$@$---##-##\n#-#-#$-$-$###...#\n#-#---$-$--##...#\n#-###$$$-$-##...#\n#-----#-##-##...#\n#####---##-##...#\n----#####-----###\n--------#-----#\n--------#######',
      titulo: '12',
      comentarios: 'Sokoban2 #4',
    },
    {
      texto:
        '################\n#--------------#\n#-#-######-----#\n#-#--$-$-$-$#--#\n#-#---$@$---##-##\n#-#--$-$-$###...#\n#-#---$-$--##...#\n#-###$$$-$-##...#\n#-----#-##-##...#\n#####---##-##...#\n----#####-----###\n--------#-----#\n--------#######',
      titulo: '12X',
      comentarios:
        "Sokoban2 #4. The wall at E6( E'th collumn, 6th row) was removed in the XSokoban levelset.",
    },
    {
      texto:
        '---#########\n--##---##--######\n###-----#--#----###\n#--$-#$-#--#--...-#\n#-#-$#@$##-#-#.#.-#\n#--#-#$--#----.-.-#\n#-$----$-#-#-#.#.-#\n#---##--##$-$-.-.-#\n#-$-#---#--#$#.#.-#\n##-$--$---$--$...-#\n-#$-######----##--#\n-#--#----##########\n-####',
      titulo: '13',
      comentarios: 'Sokoban2 #3. Arranged. Minus two boxes.',
    },
    {
      texto:
        '-------#######\n-#######-----#\n-#-----#-$@$-#\n-#$$-#---#########\n-#-###......##---#\n-#---$......##-#-#\n-#-###......-----#\n##---####-###-#$##\n#--#$---#--$--#-#\n#--$-$$$--#-$##-#\n#---$-$-###$$-#-#\n#####-----$---#-#\n----###-###---#-#\n------#-----#---#\n------########--#\n-------------####',
      titulo: '14',
      comentarios: 'Sokoban2 #7.',
    },
    {
      texto:
        '---########\n---#---#--#\n---#--$---#\n-###-#$---####\n-#--$--##$---#\n-#--#-@-$-#-$#\n-#--#------$-####\n-##-####$##-----#\n-#-$#.....#-#---#\n-#--$..**.-$#-###\n##--#.....#---#\n#---###-#######\n#-$$--#--#\n#--#-----#\n######---#\n-----#####',
      titulo: '15',
      comentarios: 'Sokoban2 #5. Arranged.',
    },
    {
      texto:
        '#####\n#---##\n#----#--####\n#-$--####--#\n#--$$-$---$#\n###@-#$----##\n-#--##--$-$-##\n-#-$--##-##-.#\n-#--#$##$--#.#\n-###---$..##.#\n--#----#.*...#\n--#-$$-#.....#\n--#--#########\n--#--#\n--####',
      titulo: '16',
      comentarios: 'Sokoban2 #6.',
    },
    {
      texto:
        '---##########\n---#..--#---#\n---#..------#\n---#..--#--####\n--#######--#--##\n--#------------#\n--#--#--##--#--#\n####-##--####-##\n#--$--#####-#--#\n#-#-$--$--#-$--#\n#-@$--$---#---##\n####-##-#######\n---#----#\n---######',
      titulo: '17',
      comentarios: 'SokobanMSX #21.',
    },
    {
      texto:
        '-----###########\n-----#--.--#---#\n-----#-#.----@-#\n-#####-##..#-####\n##--#-..###-----###\n#-$-#...---$-#--$-#\n#----..-##--##-##-#\n####$##$#-$-#---#-#\n--##-#----#$-$$-#-#\n--#--$-#-#--#-$##-#\n--#---------------#\n--#--###########--#\n--####---------####',
      titulo: '18',
      comentarios: 'Sokoban2 #8. Arranged. Minus two boxes.',
    },
    {
      texto:
        '--######\n--#---@####\n#####-$---#\n#---##----####\n#-$-#--##----#\n#-$-#--#####-#\n##-$--$----#-#\n##-$-$-###-#-#\n##-#--$--#-#-#\n##-#-#$#---#-#\n##-###---#-#-######\n#--$--####-#-#....#\n#----$----$---..#.#\n####$--$#-$---....#\n#-------#--##-....#\n###################',
      titulo: '19',
      comentarios: 'Sokoban2 #9. Arranged. Minus five boxes.',
    },
    {
      texto:
        '----##########\n#####--------####\n#-----#---$--#@-#\n#-#######$####--###\n#-#----##-#--#$-..#\n#-#-$--$--#--#--#.#\n#-#-$--#-----#$-..#\n#-#--###-##-----#.#\n#-###--#--#--#$-..#\n#-#----#-$####--#.#\n#-#$---$--$--#*-..#\n#----$-#-$-$-#--#.#\n####-$###----#*-..#\n---#----$$-###....#\n---#------##-######\n---########',
      titulo: '20',
      comentarios: 'Sokoban2 #10. Arranged and rotated. Minus nine(!) boxes.',
    },
    {
      texto:
        '----##########\n#####--------####\n#-----#---$--#@-#\n#-#######$####--###\n#-#----##-#--#$-..#\n#-#-$-----#--#--#.#\n#-#-$--#-----#$-..#\n#-#--###-##-----#.#\n#-###--#--#--#$-..#\n#-#----#--####--#.#\n#-#$---$--$--#$-..#\n#----$-#-$-$-#--#.#\n####-$###----#$-..#\n---#----$$-###....#\n---#------##-######\n---########',
      titulo: '20X',
      comentarios:
        'Sokoban2 #10. Arranged and rotated. Minus nine(!) boxes. In the XSokoban levelset the boxes at H6 and J10 and the goals at O11 and O13 were removed.',
    },
    {
      texto:
        '#########\n#-------#\n#-------####\n##-####-#--#\n##-#@##----#\n#-$$$-$--$$#\n#--#-##-$--#\n#--#-##--$-####\n####--$$$-$#--#\n-#---##---....#\n-#-#---#-#..-.#\n-#---#-#-##...#\n-#####-$--#...#\n-----##---#####\n------#####',
      titulo: '21',
      comentarios: 'Sokoban2 #16.',
    },
    {
      texto:
        '######-----####\n#----#######--#####\n#---$#--#--$--#---#\n#--$--$--$-#-$-$--#\n##$-$---#-@#-$----#\n#--$-###########-##\n#-#---#.......#-$#\n#-##--#-......#--#\n#-#---$........$-#\n#-#-$-#....-..#--#\n#--$-$####$####-$#\n#-$---###-$---$--##\n#-$-----$-$--$----#\n##-######-$-#####-#\n#---------#-------#\n###################',
      titulo: '22',
      comentarios: 'Sokoban2 #12. Arranged. Minus 8 boxes.',
    },
    {
      texto:
        '----#######\n----#--#--####\n#####-$#$-#--##\n#..-#--#--#---#\n#..-#-$#$-#--$####\n#.--#-----#$--#--#\n#..---$#--#-$----#\n#..@#--#$-#$--#--#\n#..-#-$#-----$#--#\n#..-#--#$$#$--#--##\n#..-#-$#--#--$#$--#\n#..-#--#--#---#---#\n##.-####--#####---#\n-####--####---#####',
      titulo: '23',
      comentarios: 'Sokoban2 #13. Arranged.',
    },
    {
      texto:
        '###############\n#..........--.####\n#..........$$.#--#\n###########$-#---##\n#------$--$-----$-#\n##-####---#--$-#--#\n#------#---##--#-##\n#--$#--#-##--###-##\n#-$-#$###----###-##\n###--$-#--#--###-##\n###----$-##-#--#-##\n-#-$--#--$--$-$---#\n-#--$--$#$$$--#---#\n-#--#--$------#####\n-#-@##--#--#--#\n-##############',
      titulo: '24',
      comentarios: 'Sokoban2 #14. Arranged. Minus one box.',
    },
    {
      texto:
        '####\n#--##############\n#--#---..#......#\n#--#-#-#####-...#\n##$#----........#\n#---##$######--####\n#-$-#-----######@-#\n##$-#-$---######--#\n#--$-#$$$##-------#\n#------#----#$#$###\n#-####-#$$$$$----#\n#-#----$-----#---#\n#-#---##-##-----###\n#-######$######-$-#\n#--------#----#---#\n##########----#####',
      titulo: '25',
      comentarios: 'Sokoban2 #15. Arranged. Minus two boxes.',
    },
    {
      texto:
        '####\n#--##############\n#--#---..#......#\n#--#-#-#####-...#\n##$#----........#\n#---##$######--####\n#-$-#-----######@-#\n##$-#-$---######--#\n#--$-#$$$##-------#\n#------#----#$#$###\n#-####-#$$$$$----#\n#-#----$-----#---#\n#-#---##--------###\n#-######$######-$-#\n#--------#----#---#\n##########----#####',
      titulo: '25X',
      comentarios:
        'Sokoban2 #15. Arranged. Minus two boxes. In the XSokoban levelset 2 walls at K13 and L13 were removed.',
    },
    {
      texto:
        '-#######\n-#--#--#####\n##--#--#...###\n#--$#--#...--#\n#-$-#$$-...--#\n#--$#--#...-.#\n#---#-$########\n##$-------$-$-#\n##--#--$$-#---#\n-######--##$$@#\n------#------##\n------########',
      titulo: '26',
      comentarios: 'Sokoban2 #21.',
    },
    {
      texto:
        '-#################\n-#...---#----#---##\n##.....--$##-#-#$-#\n#......#--$--#----#\n#......#--#--#-#--#\n#########-$--$-$--#\n--#-----#$##$-##$##\n-##---$----#-$----#\n-#--##-###-#--##$-#\n-#-$-$$-----$--$--#\n-#-$----$##$-######\n-#######--@-##\n-------######',
      titulo: '27',
      comentarios: 'Sokoban2 #17. Arranged.',
    },
    {
      texto:
        '---------#####\n-----#####---#\n----##-$--$--####\n#####-$--$-$-##.#\n#-------$$--##..#\n#--######-###..-#\n##-#--#----#...-#\n#-$---#----#...-#\n#@-#$-##-####...#\n####--$-$$--##..#\n---##--$-$--$...#\n----#-$$--$-#--.#\n----#---$-$--####\n----######---#\n---------#####',
      titulo: '28',
      comentarios: 'Sokoban2 #18. Rotated.',
    },
    {
      texto:
        '#####\n#---##\n#-$--#########\n##-#-#-------######\n##-#---$#$#@--#---#\n#--#------$-#---$-#\n#--###-#########-##\n#--##-..*.....-#-##\n##-##-*.*..*.*-#-##\n#-$##########-##$-#\n#--$---$--$----$--#\n#--#---#---#---#--#\n###################',
      titulo: '29',
      comentarios: 'Sokoban2 #43. Rotated.',
    },
    {
      texto:
        '-------###########\n-------#---#-----#\n#####--#-----$-$-#\n#---#####-$##-#-##\n#-$-##---#-##-$--#\n#-$--@$$-#-##$$$-#\n##-###---#-##----#\n##-#---###-#####$#\n##-#-----$--#....#\n#--###-##-$-#....##\n#-$---$-#---#..$.-#\n#--##-$-#--##....-#\n#####---######...##\n----#####----#####',
      titulo: '30',
      comentarios: 'Sokoban2 #20. Arranged and rotated.',
    },
    {
      texto:
        '--####\n--#--#########\n-##--##--#---#\n-#--$#-$@$---####\n-#$--$--#-$-$#--##\n##--$##-#$-$-----#\n#--#--#-#---$$$--#\n#-$----$--$##-####\n#-$-$-#$#--#--#\n##--###--###$-#\n-#--#....-----#\n-####......####\n---#....####\n---#...##\n---#...#\n---#####',
      titulo: '31',
      comentarios: 'Sokoban2 #22.',
    },
    {
      texto:
        '------####\n--#####--#\n-##-----$#\n##-$--##-###\n#@$-$-#-$--#\n####-##---$#\n-#....#$-$-#\n-#....#---$#\n-#....--$$-##\n-#...-#-$---#\n-######$-$--#\n------#---###\n------#$-###\n------#--#\n------####',
      titulo: '32',
      comentarios: 'Sokoban2 #23.',
    },
    {
      texto:
        '############\n##-----##--#\n##---$---$-#\n####-##-$$-#\n#---$-#----#\n#-$$$-#-####\n#---#-#-$-##\n#--#--#--$-#\n#-$#-$#----#\n#---..#-####\n####..-$-#@#\n#.....#-$#-#\n##....#--$-#\n###..##----#\n############',
      titulo: '33',
      comentarios: 'Sokoban2 #24.',
    },
    {
      texto:
        '-#########\n-#....---##\n-#.#.#--$-##\n##....#-#-@##\n#-....#--#--##\n#-----#$-##$-#\n##-###--$----#\n-#$--$-$-$#--#\n-#-#--$-$-##-#\n-#--###--##--#\n-#----##-##-##\n-#--$-#--$--#\n-###$-$---###\n---#--#####\n---####',
      titulo: '34',
      comentarios: 'Sokoban2 #28.',
    },
    {
      texto:
        '############-######\n#---#----#-###....#\n#---$$#---@--.....#\n#---#-###---#-....#\n##-##-###--#--....#\n-#-$-$-----#-#-####\n-#--$-$##--#------#\n####-#--####-#-##-#\n#--#-#$---##-#----#\n#-$--$--#-##-#---##\n#-#-$-$----#-#---#\n#--$-##-##-#-#####\n#-$$-----$$--#\n##-##-###-$--#\n-#----#-#----#\n-######-######',
      titulo: '35',
      comentarios: 'Sokoban2 #25. Arranged.',
    },
      {
          texto: `------------#####
#####--######---#
#---####--$-$-$-#
#-$---##-##-##--##
#---$-$-----$--$-#
###-$--##-##-----##
--#-#####-#####$$-#
-##$#####-@##-----#
-#-$--###$###-$--##
-#-$--#---###--###
-#-$$-$-#---$$-#
-#-----#---##--#
-#######..-.###
----#.........#
----#.........#
----###########`,
          titulo: '36',
          comentarios: 'Sokoban2 #26. Arranged and rotated.',
      },
      {
          texto: `###########
#......---#########
#......---#--##---#
#..###-$----$-----#
#...-$-$-#--###---#
#...#$#####----#--#
###----#---#$--#$-#
--#--$$-$-$--$##--#
--#--$---#$#$-##$-#
--###-##-#----##--#
---#--$-$-##-######
---#----$--$--#
---##---#-#---#
----#####@#####
--------###`,
          titulo: '37',
          comentarios: 'Sokoban2 #27. Arranged.',
      },
      {
          texto: `###########
#......---#########
#......---#--##---#
#..###-$----$-----#
#...-$-$-#---##---#
#...#$#####----#--#
###----#---#$--#$-#
--#--$$-$-$--$##--#
--#--$---#$#$-##$-#
--###-##-#----##--#
---#--$-$-##-######
---#----$--$--#
---##---#-#---#
----#####@#####
--------###`,
          titulo: '37X',
          comentarios:
              'Sokoban2 #27. Arranged. In the XSokoban levelset the wall at \nM5 was removed.',
      },
      {
          texto: `------####
#######-@#
#-----$--#
#---$##-$#
##$#...#-#
-#-$...--#
-#-#.-.#-##
-#---#-#$-#
-#$--$----#
-#--#######
-####`,
          titulo: '38',
          comentarios: 'Sokoban2 #30.',
      },
      {
          texto: `-------------######
-#############....#
##---##-----##....#
#--$$##--$-@##....#
#------$$-$#--....#
#--$-##-$$-#-#-...#
#--$-##-$--#--....#
##-#####-###-##.###
##---$--$-##---.--#
#-$###--#-#####-###
#---$---#-------#
#--$-#$-$-$###--#
#-$$$#-$---#-####
#----#--$$-#
######---###
-----#####`,
          titulo: '39',
          comentarios: 'Sokoban2 #29. Arranged.',
      },
      {
          texto: `----############
----#----------##
----#--#-#$$-$--#
----#$-#$#--##-@#
---##-##-#-$-#-##
---#---$-#$--#-#
---#---#-$---#-#
---##-$-$---##-#
---#--#--##--$-#
---#----##-$$#-#
######$$---#---#
#....#--########
#.#...-##
#....---#
#....---#
#########`,
          titulo: '40',
          comentarios: 'Sokoban2 #33.',
      },
      {
          texto: `-----------#####
----------##---##
---------##-----#
--------##--$$--#
-------##-$$--$-#
-------#-$----$-#
####---#---$$-#####
#--########-##----#
#.------------$$$@#
#.#-#######-##---##
#.#-#######.-#$-$##
#...........-#----#
##############--$-#
-------------##--##
--------------####`,
          titulo: '41',
          comentarios: 'Sokoban2 #31. Arranged. Minus one box.',
      },
      {
          texto: `-----########
--####------######
--#----##-$-$---@#
--#-##-##$#$-$-$##
###-......#--$$-##
#---......#--#---#
#-#-......#$--$--#
#-#-......-$$#-$-#
#-$-###-###$--$-##
###--$--$--$--$-#
--#--$--$--$--$-#
--######---######
-------#####`,
          titulo: '42',
          comentarios: 'Sokoban2 #32. Arranged.',
      },
      {
          texto: `-----########
--####------######
--#----##-$-$---@#
--#-##-##$#$-$-$##
###-......#--$$-##
#---......#--#---#
#-#-......#$--$--#
#-#$......-$$#-$-#
#---###-###$--$-##
###--$--$--$--$-#
--#--$--$--$--$-#
--######---######
-------#####`,
          titulo: '42X',
          comentarios:
              'Sokoban2 #32. Arranged. In the XSokoban levelset the box at \nC9 moved to D8.',
      },
      {
          texto: `--------#######
----#####--#--####
----#---#---$----#
-####-#$$-##-##--#
##------#-#--##-###
#--###-$#$--$--$--#
#...----#-##--#---#
#...#----@-#-###-##
#...#--###--$--$--#
########-##---#---#
----------#########`,
          titulo: '43',
          comentarios: 'Sokoban2 #35.',
      },
      {
          texto: `-#####
-#---#
-#-#-#######
-#------$@######
-#-$-##$-###---#
-#-####-$----$-#
-#-#####-#--#$-####
##--####-##$------#
#--$#--$--#-##-##-#
#---------#-#...#-#
######--###--...--#
-----####-#-#...#-#
----------#-###-#-#
----------#-------#
----------#########`,
          titulo: '44',
          comentarios: 'Sokoban2 #37.',
      },
      {
          texto: `#####-####
#...#-#--####
#...###--$--#
#....##-$--$###
##....##---$--#
###...-##-$-$-#
#-##----#--$--#
#--##-#-###-####
#-$-#-#$--$----#
#--$-@-$----$--#
#---#-$-$$-$-###
#--######--###
#-##----####
###`,
          titulo: '45',
          comentarios: 'SokobanMSX #51.',
      },
      {
          texto: `##########
#--------####
#-######-#--##
#-#-$-$-$--$-#
#-------#$---#
###$--$$#--###
--#--##-#-$##
--##$#---$-@#
---#--$-$-###
---#-#---$--#
---#-##---#-#
--##--#####-#
--#---------#
--#.......###
--#.......#
--#########`,
          titulo: '46',
          comentarios: 'Sokoban2 #46.',
      },
      {
          texto: `---------####
-#########--##
##--$------$-#####
#---##-##---##...#
#-#$$-$-$$#$##...#
#-#---@---#---...#
#--$#-###$$---...#
#-$--$$--$-##....#
###$-------#######
--#--#######
--####`,
          titulo: '47',
          comentarios: 'Sokoban2 #47.',
      },
      {
          texto: `--#########
--#*.*#*.*#
--#.*.*.*.#
--#*.*.*.*#
--#.*.*.*.#
--#*.*.*.*#
--###---###
----#---#
######-######
#-----------#
#-$-$-$-$-$-#
##-$-$-$-$-##
-#$-$-$-$-$#
-#---$@$---#
-#--#####--#
-####---####`,
          titulo: '48',
          comentarios: 'Sokoban2 #2.',
      },
      {
          texto: `-------####
-------#--##
-------#---##
-------#-$$-##
-----###$--$-##
--####----$---#
###--#-#####--#
#----#-#....$-#
#-#---$-....#-#
#--$-#-#.*..#-#
###--####-###-#
--####-@$--##$##
-----###-$-----#
-------#--##---#
-------#########`,
          titulo: '49',
          comentarios: 'Sokoban2 #38.',
      },
      {
          texto: `------############
-----##..----#---#
----##..*-$----$-#
---##..*.#-#-#$-##
---#..*.#-#-#-$--#
####...#--#----#-#
#--##-#----------#
#-@$-$-###--#-#-##
#-$---$---#-#---#
###$$---#-#-#-#-#
--#---$---#-#-#####
--#-$#-#####------#
--#$---#---#---#--#
--#--###---##-----#
--#--#------#----##
--####------######`,
          titulo: '50',
          comentarios: 'Sokoban2 #39.',
      },
      {
          texto: `------############
-----##..----#---#
----##..*-$----$-#
---##..*.#-#-#-$##
---#..*.#-#-#-$--#
####...#--#----#-#
#--##-#----------#
#-@$-$-###--#---##
#-$---$---#-#---#
###$$---#-#-#-#-#
--#---$---#-#-#####
--#-$#-#####------#
--#$---#---#----#-#
--#--###---##-----#
--#--#------#----##
--####------######`,
          titulo: '50X',
          comentarios:
              'Sokoban2 #39. In the XSokoban levelset the box at O4 moved to \nP4, the wall at O8 disappeared and the wall at P13 moved to Q13',
      },
      {
          texto: `-#########
-#-------#
-#-$-$$-$#
###-#--$-#
#.#---$$-##
#.###---$-#
#.#.-$-##-####
#...--$##-$--#
#...$---$----#
#..###$###-#@#
#..#-#-----###
####-#######`,
          titulo: '51X',
          comentarios: '',
      },
      {
          texto: `-----------########
-----------#......#
---####----#......#
---#--#########...#
---#-$---$----#...#
---#--#-#-#-#-#---#
#####-#-#-#@#-#---#
#---#-###-###-##-##
#----$-#-$-$-$-#-#
#-$$$--$---#-----#
#---#-###$###$##-#
###-#--$---#-----#
-##-$--#-$-$-$-###
-#--#-###-###-##
-#-$----------#
-#--###########
-####`,
          titulo: '52X',
          comentarios: '',
      },
      {
          texto: `####################
#----------------###
#-$#---$-##--$----##
#----$###----#-$$-##
#.###-----$-$-##--##
#...#--#--#----#$--#
#..##$$####-$--#---#
#...#------$-##--###
#...$--###--#----#-#
##..--$#--##---##@-#
###.#--------------#
####################`,
          titulo: '53X',
          comentarios: '',
      },
      {
          texto: `####################
#---#----#---#---#@#
#-$------$---$---#-#
##-###..##-###-----#
#---#....#$#--$###-#
#-$-#....#--$--$-$-#
#---#....#-#-#-$-$-#
#---##..##---#$#---#
##$##----##--#--#$##
#---$--$-----#--#--#
#---#----#---#-----#
####################`,
          titulo: '54X',
          comentarios: '',
      },
      {
          texto: `####################
#----@##------#---##
#----##----$----$-##
#--###....#-#-#--###
#---#....#-#-#-$---#
###-#...#--#-------#
##--##.#-----$---$-#
##--$-$-###--#-#-###
##-$-------#-#-$---#
####-$--$#-#-#-#-$-#
####---------#-#--##
####################`,
          titulo: '55X',
          comentarios: `A remodel using the goal- and storing- area from Original 50. 
But the level is open so you can fill the goal from both sides and no 
longer need to push all the boxes through the goal area to solve the 
level`,
      },
    
  {
    "texto": "####################\n#--#--##----#---@###\n##----$----#-$###--#\n##$#-$-##$#-$-$----#\n#---$#----$------###\n#-##---$-###--#....#\n#-#-$#-#-#-#-#....##\n#----$-$-#--#....###\n##$-###--$-#....####\n#--#-$--------######\n#------#-#----######\n####################",
    "titulo": "56X",
    "comentarios": ""
  },
  {
    "texto": "####################\n#@-----###---#--#--#\n#-#-#--#--$--$-----#\n#####-----#-$-$#$#-#\n#.#..#----##$-$----#\n#.....----$---#---##\n#.....----###$##$###\n#.#..#----$----#---#\n#####-----#--#$--$-#\n#####--#--$----$-$-#\n#####--#--#--#--#--#\n####################",
    "titulo": "57X",
    "comentarios": ""
  },
  {
    "texto": "####################\n##...---##-#----#--#\n#....---------$-##-#\n#....#-#-#$###$----#\n#...#----#-------#-#\n##.#--#$-#-----$##-#\n#--#--#-$-$-###--$-#\n#-----$--$-#--#-##-#\n##-#-##-#$$#-$#--#-#\n#--#---$-$-#------##\n#----#-----#--#---@#\n####################",
    "titulo": "58X",
    "comentarios": ""
  },
  {
    "texto": "####################\n#---#--#@#-##--#####\n#-#-#--$----$--#####\n#-#----######-$--###\n#---#--#....#--$$--#\n##$##$##....#------#\n#------#....##$##$##\n#--$$--#....#------#\n#-$--$--#--#--###--#\n#####--$---$----$--#\n#####-#----#--#---##\n####################",
    "titulo": "59X",
    "comentarios": ""
  },
  {
    "texto": "####################\n#-#-----#----------#\n#-------$--##-###-##\n#####--##---$--$---#\n##..##--#-#-$-#-#--#\n#....--$-----##$#-##\n#....--$#####---#$##\n##..#-#--#---#--$--#\n###.#-#--$---$--#-@#\n##--$--$-#---#--####\n##-------###########\n####################",
    "titulo": "60X",
    "comentarios": ""
  },
  {
    "texto": "####################\n#-----###..###-----#\n#-$$--###..###--$@-#\n#--#-##......#--$--#\n#-----#......#--$--#\n####--###..######$-#\n#---$$$-#..#----#--#\n#-$#---$--$--$$-#$-#\n#--#--##-$--##--#--#\n#-$----$-##-$----$-#\n#--#--##----##--#--#\n####################",
    "titulo": "61X",
    "comentarios": ""
  },
  {
    "texto": "####################\n#----#--#-#--#--#--#\n#-@#-#-##-$---$---##\n####-#----#--#-$---#\n#----#-##-#$-##-##-#\n#------$---$---$---#\n#..###$$##-$##$-##-#\n#..#.#--#-$---$-#--#\n#....#-$$---##$-####\n#....#--#####------#\n#...###--------##--#\n####################",
    "titulo": "62X",
    "comentarios": ""
  },
  {
    "texto": "####################\n#....#-------#--#--#\n#....#-#-$--$------#\n#....-##--$#-#-$#$-#\n#...#---$---$#--$--#\n#..####--#-$---$$--#\n#------####-####-###\n#--------#---#-----#\n#-##---#---$-#-$-$-#\n#-##----$-##-$--$--#\n#-----@#-----#---#-#\n####################",
    "titulo": "63X",
    "comentarios": ""
  },
  {
    "texto": "####################\n#....###-----------#\n#....#####-#--#$#-##\n#....###---#$--$---#\n#....###----$--#$$##\n##--####-$#--#$-$--#\n##--####--$--$--#--#\n#@--####$###$##-$--#\n##--------#--#--$--#\n##---###--#--$--####\n########--#--#-----#\n####################",
    "titulo": "64X",
    "comentarios": ""
  },
  {
    "texto": "####################\n#-----#-----@#...###\n#-----#------##...##\n#-#-#-##$##-##-....#\n#---$-#---$$$--....#\n###$###-$$--###-##.#\n#-----$--#----#-####\n#--$--#--###--#-#--#\n##-#$##----$--$$---#\n#---$-##---#--#-#--#\n#-----#----#--#----#\n####################",
    "titulo": "65X",
    "comentarios": ""
  },
  {
    "texto": "####################\n#-----#--#...#@----#\n#-#-------....#----#\n#--$--#---#....#---#\n#-##$####-##....#--#\n#-$---$--#--#...#--#\n#-$$-#---#---#-$$--#\n###--$$$#---$$--$--#\n#-$--#--#----#-$#--#\n#---$#--#-------$--#\n#--#----#----#--#--#\n####################",
    "titulo": "66X",
    "comentarios": ""
  },
  {
    "texto": "####################\n#####@###.##...##--#\n#####$--..#...#----#\n####----......#--$-#\n###--$-#.....##-#-##\n##--$$#-#####--$-$-#\n##-$#-$----##--$$--#\n##--#--#----#-$--$-#\n##---$$-###-#$##---#\n##-$#------$-$--$-##\n###----#----#----###\n####################",
    "titulo": "67X",
    "comentarios": ""
  },
  {
    "texto": "####################\n#@-----#---#-------#\n##-###-##--####-#-##\n#----#-#--$$-------#\n#--#-#-#-$-#-$-##-##\n#-----$-#--#$$-#---#\n#--###--#------##-##\n#..#.#-$-#--$-#----#\n#..#.#--$-#-##-$$--#\n#....##---$$--$--#-#\n#.....##--------#--#\n####################",
    "titulo": "68X",
    "comentarios": ""
  },
  {
    "texto": "####################\n#--#------#---#---##\n#-$#-$-$-##...$--$-#\n#--$--#-##....#-$--#\n#-##-$-##....#---$-#\n#-$----#....##-$---#\n#-$##--#...#-------#\n#---$$$##$##--###-##\n#-#-#--#---#--#----#\n#-$-#--$--##-------#\n#----#----#@-------#\n####################",
    "titulo": "69X",
    "comentarios": ""
  },
  {
    "texto": "####################\n#--#--#-#----#--#--#\n#---$------$-$-----#\n##-#--#$###$##--##-#\n#---$-----$--#--$--#\n#-###$##$#---#-$---#\n#-#---$-$--######-$#\n#-$--$$-$--#@#.#...#\n#-#-----#--#-#.#...#\n#-##########-#.....#\n#------------#.....#\n####################",
    "titulo": "70X",
    "comentarios": ""
  },
  {
    "texto": "####################\n#--#-----#--##----##\n#-$#---$-#-----##--#\n#-$--$--#..#-----$-#\n#-$-$--#....#---#-##\n#-$#--#......###-$-#\n#---#--#....#--#$--#\n#-$--####..#---#---#\n##-$---##-#-#-$--$##\n###-$----$#@$-$#---#\n####---#-------#---#\n####################",
    "titulo": "71X",
    "comentarios": ""
  },
  {
    "texto": "####################\n#------....#----####\n#------....--------#\n#-#-##########-----#\n#-#$---#------###..#\n#--$---#$$###---#..#\n#-$-###-$---$---#..#\n#-$-#---$-$-#--##..#\n#--#--$$-#-$-##---##\n#@##-$#--$--$-----##\n##-------##---#--###\n####################",
    "titulo": "72X",
    "comentarios": ""
  },
  {
    "texto": "####################\n#--------#---#@-#--#\n#-$$--#$$#-#-#--##-#\n#--#-$-$-#$$-#-----#\n##-#--#--#-#-#--#--#\n#---##-------#-----#\n#---#-$-#---#---#--#\n#-$-#$-#---#--$-#..#\n##$-#--####----#...#\n#--$----------#....#\n#---#--#-----#.....#\n####################",
    "titulo": "73X",
    "comentarios": ""
  },
  {
    "texto": "####################\n#-----#---#####----#\n##-$--#---####--$--#\n####-$$---#..#--#--#\n#--$--$--##..####-##\n#-$---###....---$$-#\n#--#$#---....#-#-$-#\n#-#--#-$-..###$#---#\n#-#---$-#..#---##--#\n#---$#--####---#-$##\n#-#--#----@#------##\n####################",
    "titulo": "74X",
    "comentarios": ""
  },
  {
    "texto": "####################\n#---#---#----#---#@#\n#---$--$-----#-$-#-#\n##$#-$###-#----$$#-#\n#--#--#.###--#$-$--#\n#--#$#....#--#-###-#\n#-$--#.....##----#-#\n##$--#.#....#$$-$--#\n#--######..##-#--#-#\n#--$---------$-###-#\n#---#---#--------#-#\n####################",
    "titulo": "75X",
    "comentarios": ""
  },
  {
    "texto": "####################\n#-#-#-#---#@##---#-#\n#-------------$----#\n#--##$#-#####-$-#-##\n##----##.....#--#--#\n##$##$#.....###$#$-#\n#---#-##.....#--#-##\n#--$----##..##--#--#\n#-$-#---$---$--$$$-#\n##-$--$#-#--#--$---#\n#---##---#--#------#\n####################",
    "titulo": "76X",
    "comentarios": ""
  },
  {
    "texto": "####################\n#----##---#----#---#\n#--$--$-----##-$---#\n##-#####--.######-##\n-#-##--##....####-##\n##-##$-###..##-----#\n#------#...-.#-$-$-#\n#-$-##-##-.-###-####\n#-#-$----#.##-#-#---\n#-$-$-#---.####-##--\n#-#--##-#-##--#--##-\n#######--$##$---$-#-\n------##------$-#@#-\n-------#--##-######-\n-------#######----",
    "titulo": "77X",
    "comentarios": "This puzzle was substituted by the more uninterresting level 77SL in the collection \"Scott Lindhurst-MacIntosh\""
  },
  {
    "texto": "######--#####\n#----#--#---#\n#-$--####-$-#\n#-$------$--#\n#--###@###$-#\n##########-###\n#..---##-----#\n#..---##$----#\n#..---##-$---#\n#..---##-$---#\n#..-----$-$--#\n###--#########\n--####",
    "titulo": "77SL",
    "comentarios": "This puzzle replaced the original 77 in the collection \"Scott Lindhurst- MacIntosh\""
  },
  {
    "texto": "-------###########\n-------#---------#\n-------#----$-$--#\n######-#-$-#####-#\n#----#####-$--##$#\n#-------$-$------#\n#----------##-##-#\n#----##@#####-##-#\n#----#--$-##-----#\n######-##----##--#\n-------#----#----#\n-------###########",
    "titulo": "78X",
    "comentarios": ""
  },
  {
    "texto": "#############\n#-----------#\n#-###-$$----#\n#---#-$--$--#\n#--$####$######\n#-$-##--------#####\n#--$$-$--------...#\n###-##-$$#-----...#\n--#-##---#-----...#\n--#------#-----...#\n--###@#############\n----###",
    "titulo": "79X",
    "comentarios": ""
  },
  {
    "texto": "--#################\n###@##---------...#\n#----#---------...#\n#-$--#---------...#\n#-$$-#---------...#\n##-$-###$##########\n-#-###--$-#\n##---$--$-#\n#--$-#--$-#\n#-$--#----#\n#--$-#----#\n#----#----#\n###########",
    "titulo": "80X",
    "comentarios": ""
  },
  {
    "texto": "--------------#####\n-----##########---#\n-----#--------#---#\n-----#--$-$----$$-#\n-----#-#####-##-$-#\n-----#$$---#$##-$-#\n-----#-###-#-##$--#\n######-###-$-$----#\n#....--------##---#\n#....--------######\n#....--------#\n###########@##\n----------###",
    "titulo": "81X",
    "comentarios": ""
  },
  {
    "texto": "----######\n-####----#\n-#----##-#\n-#-$-----#\n###-####-########\n#--$---$-##--...#\n#---$$-$$----...#\n#----$--$##--...#\n##@##-##-##--...#\n-###--$--########\n-#---$$--#\n-#----#--#\n-#########",
    "titulo": "82X",
    "comentarios": ""
  },
  {
    "texto": "#######-#########\n#-----#-#---##--#\n#-###-#-#---$---#\n#-#-$-###---$---#\n#---$$------##$-#\n#----####---##--#\n#@############-##\n###..----#####$-#\n--#..----####---#\n--#..-------$$--#\n--#..----####-$-#\n--#..----#--#---#\n--########--#####",
    "titulo": "83X",
    "comentarios": ""
  },
  {
    "texto": "#######\n#-----##########\n#-----#----#--##\n#-$---#---$-$--#\n#--$--#--$-##--#\n#-$$--##$-$----#\n##-#--##-#######\n##-#--##----...#\n#--#$-------...#\n#---$$------...#\n#-----##@#--...#\n################",
    "titulo": "84X",
    "comentarios": ""
  },
  {
    "texto": "############\n#------#---##\n#-$--$---#--######\n####--#####------#\n-#..--#-----####-#\n-#.####--####----#\n-#....----#--$-####\n-#-...#---#-$$$#--##\n###.####-##--$@$---#\n#-----#####-$-#----#\n#-#.#-$------$###$-#\n#-#.########--#--$-#\n#-#..--------##--$-#\n#-#-#######-$-#-#--#\n#---#-----#-------##\n#####-----##########",
    "titulo": "85X",
    "comentarios": ""
  },
  {
    "texto": "################\n#-------#@-#---#\n#-#-#-#-#-$--$$#\n#-#...#-#$$$---#\n#--...#-#-$--$$##\n#-##.##-#-##----#\n#-#...-----$----#\n#-##-###--#######\n#----#-####\n######",
    "titulo": "86X",
    "comentarios": ""
  },
  {
    "texto": "----#####\n-####---##-#####\n-#--$----###---#\n-#-$@$-$----$--#\n-#-#$########-##\n-#-#--$--#-----#\n-#-#-$-$-#-#---#\n##-#--$#-#-#####\n#--##----#-----#\n#----$-#-###---#\n#####-##--#....#\n#----$-----....#\n#---------#....#\n################",
    "titulo": "87X",
    "comentarios": ""
  },
  {
    "texto": "#############\n#........####\n#...####-#--#####\n#...#--###----$-#\n#...$$-----$-$--#\n#--.#--$-$#-$--##\n#...#-#$#---$--#\n#.#-#-$---$----#",
    "titulo": "88X",
    "comentarios": ""
  },
  {
    "texto": "-##################\n-#---$-------...#.##\n-#-------####.....-#\n-#-#######--#.....-#\n-#-#----$-$-##....##\n-#-#--$-#-#-###...#\n-#-#-$@$-$--#####-#\n##-#--$--$-$$---$-#\n#--#$#-$#---#-$##-#\n#-##----##-##-$-#-#\n#-#-$#-$-$--#-----#\n#-#---------#######\n#-########$##---#\n#--------#--$---#\n########----#####\n-------###--#\n---------####",
    "titulo": "89X",
    "comentarios": ""
  },
  {
    "texto": "####################\n#..#----#----------#\n#.$--$--#$$--$##-$##\n#.$#--###--##-##---#\n#--#-$-#--$$---$---#\n#-###--#-#--#$--####\n#--##-#-$---#@-#---#\n#-$----$--##.##--$-#\n#--#-$#-$#-$-----###\n#--#--#--#---###---#\n#--########-#------#\n#-----------#--#.#.#\n##$########$#---...#\n#----.*--#----##.#.#\n#-.*...*---$--.....#\n####################",
    "titulo": "90X",
    "comentarios": ""
  }




  ]

  user: any;
  posicionJugador!: Posicion;
  nivelOriginal!: string[][];
  nivelActual!: string [][] ;
  step = 64;
  levelOver = false
  necesarioParaGanar: number = 0;
  arrayDatosNiveles : DatosNivel[]= [];
 

  datosNivel : DatosNivel = {
    "movimientos": 0,
    "nivel": 1,
    "reinicios": -1,
    "ganado": false
  }


textoMapa = this.dataMapas[this.datosNivel.nivel - 1]



  // # -> pared
  // $ -> caja
  // . -> punto de destino
  // * -> caja en un punto de destino
  // @ -> hombrecito
  // + -> hombrecito en un punto de destino



  constructor(private supabase: SupabaseService, private authService: AuthService) {
    this.reiniciarNivel()
    this.authService.session$.subscribe(session => {
        if (session?.user) {
            // Asignamos el usuario autenticado
            this.user = session.user;
            console.log('Usuario autenticado:', this.user);
        } else {
            console.log('Usuario no autenticado');
        }
        });
  }

  ngOnDestroy(){
    let esta = false;
    for (const datos of this.arrayDatosNiveles) {
      if (datos.nivel == this.datosNivel.nivel) {
        esta = true;
      }
    }

    if(!esta) {
      const copia = { ...this.datosNivel};

      this.arrayDatosNiveles.push(copia)
    }
    this.saveGameResult();
  }

  

  @HostListener('window:keydown', ['$event'])
  handleKey(event: KeyboardEvent) {

    if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(event.key)) {
    event.preventDefault();
    }

    if (!this.levelOver){
      switch (event.key) {
        case 'ArrowUp':
          this.moverse(this.posicionJugador.fila - 1,this.posicionJugador.columna, "@")
          break;
        case 'ArrowDown':
          this.moverse(this.posicionJugador.fila + 1, this.posicionJugador.columna, "@")
          break;
        case 'ArrowLeft':
          this.moverse(this.posicionJugador.fila, this.posicionJugador.columna - 1, "@")
          break;
        case 'ArrowRight':
          this.moverse(this.posicionJugador.fila, this.posicionJugador.columna + 1, "@")
          break;
        case 'r':
          this.reiniciarNivel();
          break;
        case 'R':
          this.reiniciarNivel();
          break;
      }

      this.comprobarSiGano();
    } 
  }

  moverse (proxFila: number, proxColumna: number, tile: string){

    let tileEncontrada = this.nivelActual[proxFila][proxColumna];


    // MOVIMIENTOS JUGADOR
    if (tile == '@') {
      // Si no hay nada, se puede mover.
      if (tileEncontrada == '-') {
        // Cuando se mueve, hay que cambiar la posicion del jugador
        this.nivelActual[proxFila][proxColumna] = '@'
        //  y su posicion anterior dejarla vacía (se tiene que ver si en el original estaba él o otra cosa)
        // this.nivelActual[this.posicionJugador.fila][this.posicionJugador.columna] = '-'

        this.ponerTileOriginal(this.posicionJugador.fila, this.posicionJugador.columna)

        // cambiar la posicion que estamos teniendo en cuenta
        this.posicionJugador.fila = proxFila;
        this.posicionJugador.columna = proxColumna;

        this.datosNivel.movimientos++;

        } else if (tileEncontrada == '$') {
          this.moverse(proxFila, proxColumna, '$')

        } else if (tileEncontrada == '*') {
          this.moverse(proxFila, proxColumna, '*')
        } else if (tileEncontrada == '.') {
          // Cuando se mueve, hay que cambiar la posicion del jugador
          this.nivelActual[proxFila][proxColumna] = '+'
          //  y su posicion anterior dejarla vacía (se tiene que ver si en el original estaba él o otra cosa)
          // this.nivelActual[this.posicionJugador.fila][this.posicionJugador.columna] = '-'

          this.ponerTileOriginal(this.posicionJugador.fila, this.posicionJugador.columna)

          // cambiar la posicion que estamos teniendo en cuenta
          this.posicionJugador.fila = proxFila;
          this.posicionJugador.columna = proxColumna;

          this.datosNivel.movimientos++
        }
      }
    // MOVIMIENTOS CAJA
    else if (tile == '$' || tile == '*') {

      let diferenciaFila = (this.posicionJugador.fila - proxFila) * -1
      let diferenciaColumna =  (this.posicionJugador.columna - proxColumna) * -1
      tileEncontrada = this.nivelActual[proxFila + diferenciaFila][proxColumna + diferenciaColumna];

      if (tileEncontrada == '-') {
          
     

          // Cuando se mueve, hay que cambiar la posicion de la caja
          this.nivelActual[proxFila + diferenciaFila][proxColumna + diferenciaColumna] = '$'

          // y poner al jugador en donde estaba la caja

          if (this.nivelActual[proxFila][proxColumna] != '*')
            {this.nivelActual[proxFila][proxColumna] = '@'}
          else {
            this.nivelActual[proxFila][proxColumna] = '+'
          }
          
          // y la posicion anterior del jugador en -
          // this.nivelActual[this.posicionJugador.fila][this.posicionJugador.columna] = '-'

          this.ponerTileOriginal(this.posicionJugador.fila, this.posicionJugador.columna)

          // cambiar la posicion que estamos teniendo en cuenta
          this.posicionJugador.fila = proxFila;
          this.posicionJugador.columna = proxColumna;

          this.datosNivel.movimientos++

        }
      else if(tileEncontrada == '.') {
          // Cuando se mueve, hay que cambiar la posicion de la caja
          this.nivelActual[proxFila + diferenciaFila][proxColumna + diferenciaColumna] = '*'

          // y poner al jugador en donde estaba la caja

          if (this.nivelActual[proxFila][proxColumna] != '*')
            {this.nivelActual[proxFila][proxColumna] = '@'}
          else {
            this.nivelActual[proxFila][proxColumna] = '+'
          }
          // y la posicion anterior del jugador en -
          // this.nivelActual[this.posicionJugador.fila][this.posicionJugador.columna] = '-'

          this.ponerTileOriginal(this.posicionJugador.fila, this.posicionJugador.columna)

          // cambiar la posicion que estamos teniendo en cuenta
          this.posicionJugador.fila = proxFila;
          this.posicionJugador.columna = proxColumna;

          this.datosNivel.movimientos++
      }
    }

  }

  ponerTileOriginal(fila:number, columna:number) {

    let tileOriginal = this.nivelOriginal[fila][columna]

    if (tileOriginal == '@' || tileOriginal == '$') {
      this.nivelActual[fila][columna] = '-'
    } else {
      this.nivelActual[fila][columna] = this.nivelOriginal[fila][columna]
    }

  }

  reiniciarNivel(){
    // Crea un nivel nuevo
    this.nivelOriginal = this.mapaDesdeTexto(this.dataMapas[this.datosNivel.nivel - 1].texto)

    // Hace una copia, para modificar la copia y guardar el original
    this.nivelActual = this.nivelOriginal.map((f: string[]) => f.slice());

    this.posicionJugador = this.encontrarPosicion('@');

    this.necesarioParaGanar = this.nivelOriginal.flat().filter((simbolo: string) => simbolo === '.').length;
    this.necesarioParaGanar += this.nivelOriginal.flat().filter((simbolo: string) => simbolo === '*').length;
    this.necesarioParaGanar += this.nivelOriginal.flat().filter((simbolo: string) => simbolo === '+').length;

    // Sirve para debug, descomentar para ganar rapido.
    //this.necesarioParaGanar = 1;
    
    this.datosNivel.reinicios++
    this.datosNivel.movimientos = 0;
    this.datosNivel.ganado = false;
  }


  comprobarSiGano(){
    const cantidadActual = this.nivelActual.flat().filter(simbolo => simbolo === '*').length;

    console.log(`Necesario para ganar ${this.necesarioParaGanar}. Actual: ${cantidadActual}`)

    if(cantidadActual == this.necesarioParaGanar){
      this.datosNivel.ganado = true;
      this.levelOver = true;
    }

  }

  pasarNivel() {
    const copia = { ...this.datosNivel};
    this.arrayDatosNiveles.push(copia);
    this.datosNivel.nivel++;
    this.datosNivel.reinicios = 0;
    this.levelOver = false;
    this.reiniciarNivel()
    this.datosNivel.reinicios -= 1;

  }

  /// HELPERS 
  
  mapaDesdeTexto(texto: string): string[][] {
    return texto
      .trim()                        // Elimina espacios en blanco al inicio y final
      .split('\n')                   // Divide por líneas
      .map(linea => linea.split('')) // Divide cada línea en caracteres individuales
  }

  encontrarPosicion(valor: string ) {
      for (let fila = 0; fila < this.nivelActual.length; fila++) {
        const columna = this.nivelActual[fila].indexOf(valor);

        if (columna !== -1) {
          return { fila, columna };
        }
      }
      throw new Error(`Valor '${valor}' no encontrado en la matriz`);
    }

    async saveGameResult(): Promise<void> {

      let reinicios_totales = this.arrayDatosNiveles.reduce((total, nivel) => total + nivel.reinicios, 0)
      let movimientos_totales = this.arrayDatosNiveles.reduce((total, nivel) => total + nivel.movimientos, 0)

      const { error } = await this.supabase.getClient()
        .from('sokoban')
        .insert([
          {
            email: this.user.email,
            puntos: this.arrayDatosNiveles.length * 1000 - movimientos_totales - reinicios_totales,
            nivel_maximo: this.arrayDatosNiveles.length,
            movimientos_totales: movimientos_totales,
            reinicios_totales: reinicios_totales,
            niveles: JSON.stringify(this.arrayDatosNiveles),
            user_id: this.user.id, 
          }
        ]);

      if (error) {
        console.error('Error al guardar el juego:', error);
      } else {
        console.log('Juego guardado con éxito');
      }
  }


}
